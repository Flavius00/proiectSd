http:
  # Define URL routing rules, middlewares, and services
  routers:
    nginx-frontend:
      rule: "Host(`localhost`)" # Match requests to localhost without /api prefix
      entryPoints:
        - web # Listen on the web (HTTP) entry point
      service: nginx # Forward to the nginx service

    user-api:
      rule: "Host(`localhost`) && PathPrefix(`/api/users`)" # Match requests to localhost with /api prefix
      entryPoints:
        - web # Listen on the web (HTTP) entry point
      middlewares:
        - jwt-authenticator
        - strip-api-prefix # Remove /api prefix before forwarding
      service: user-service # Forward to the user-service

    device-api:
      rule: "Host(`localhost`) && PathPrefix(`/api/devices`)" # Match requests to localhost with /api prefix
      entryPoints:
        - web # Listen on the web (HTTP) entry point
      middlewares:
        - jwt-authenticator
        - strip-api-prefix # Remove /api prefix before forwarding
      service: device-service # Forward to the device-service

    auth-api:
      rule: "Host(`localhost`) && PathPrefix(`/api/auth`)" # Match requests to localhost with /api prefix
      entryPoints:
        - web # Listen on the web (HTTP) entry point
      middlewares:
        - strip-api-prefix # Remove /api prefix before forwarding
      service: auth-service # Forward to the auth-service

    monitoring-api:
      rule: "Host(`localhost`) && PathPrefix(`/api/monitoring`)" # Match requests to localhost with /api prefix
      entryPoints:
        - web # Listen on the web (HTTP) entry point
      middlewares:
        - jwt-authenticator
        - strip-api-prefix # Remove /api prefix before forwarding
      service: monitoring-service # Forward to the monitoring-service

  middlewares:
    strip-api-prefix: # Middleware to remove /api prefix
      stripPrefix:
        prefixes:
          - "/api"

    jwt-authenticator:
      forwardAuth:
        address: "http://auth-service:8080/auth/validate"

    auth-basic: # Middleware for basic authentication
      basicAuth:
        users:
          - "user:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/" # password = "test"

  services:
    nginx:
      loadBalancer:
        servers:
          - url: "http://nginx:80" # Container name solved by Docker DNS

    user-service:
      loadBalancer:
        servers:
          - url: "http://spring-demo:8080" # Container name solved by Docker DNS

    device-service:
      loadBalancer:
        servers:
          - url: "http://device-service:8080" # Container name solved by Docker DNS

    auth-service:
      loadBalancer:
        servers:
          - url: "http://auth-service:8080" # Container name solved by Docker DNS

    monitoring-service:
      loadBalancer:
        servers:
          - url: "http://monitoring-service:8080" # Container name solved by Docker DNS
